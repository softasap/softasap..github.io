



<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>Deploying a Ruby Application with Ansible</title>
  

  <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,700,100%7CRoboto:400,700,300,100' rel='stylesheet' type='text/css'>

<!-- Bootstrap and Font Awesome css -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<link href=".././_static/css/bootstrap.min.css" rel="stylesheet">

<!-- Theme stylesheet -->
<link href=".././_static/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">

<!-- owl carousel css -->

<link href=".././_static/css/owl.carousel.css" rel="stylesheet">
<link href=".././_static/css/owl.theme.css" rel="stylesheet">

<!-- CSS Animations -->
<link href=".././_static/css/animate.css" rel="stylesheet">

<!-- CSS Animations -->
<link href=".././_static/css/custom.css" rel="stylesheet">

<!-- Mordernizr -->
<script src=".././_static/js/modernizr-2.6.2.min.js"></script>

<!-- Responsivity for older IE -->
<!--[if lt IE 9]>
<script src=".././_static/js/respond.min.js"></script>
<![endif]-->
<!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
mixpanel.init("d8c471ba307480a6d444f5a567340548");</script><!-- end Mixpanel -->
</head>

<body data-spy="scroll" data-target="#navigation" data-offset="120" class="__blog_2016_04_deploying_ruby">

    <!-- *** NAVBAR *** -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation" id="navbar">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand scrollTo" href="/#intro">Get your software deployed in a quick and robust way</a>
        </div>

        <div class="navbar-collapse collapse" id="navigation">

            <ul class="nav navbar-nav navbar-right">
                <li><a href="/#services">Services</a>
                </li>
                <li><a href="/#devops">Devops recipes</a>
                </li>
                <li><a href="/#contact">Contact</a>
                </li>
                <li><a href="/blog/archive.html">Blog</a>
                </li>
            </ul>
        </div>
        <!--/.nav-collapse -->

    </div>
</div>
<!-- /#navbar -->
    <!-- *** NAVBAR END *** -->

    <div id="all">
      <div class="mb20 block-text">
        


<div class="section section__top">
<div class="row">
  <div class="col-sm-1 mb20">
  </div>
  <div class="col-sm-8 mb20">
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="2016-03-gitflow.html">
    <i class="fa fa-arrow-circle-left"></i>
    Implementing git-flow Releasing Model in Continuous Integration Process
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="2016-05-jenkins.html">
    Setup & Configure Jenkins for Your Team
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  </div>
  <div class="col-sm-3 mb20">
  </div>
</div>
<div class="row">
<div class="col-sm-1 mb20">
</div>
<div class="col-sm-8 mb20">
  

    

    <div>
  
  <i class="fa fa-calendar"></i>
    Apr 10, 2016
  
</div>

  

  

  
  <span><i class="fa-fw fa fa-folder-open"></i>
    
      
      <a href="category/from-oops-to-devops.html">from-oops-to-devops</a>
      
    </span>
  

  
  <span><i class="fa-fw fa fa-tags"></i>
      
    
      
      <a href="tag/ruby.html">ruby</a>,
      
    
      
      <a href="tag/deployment.html">deployment</a>,
      
    
      
      <a href="tag/ansible.html">ansible</a>,
      
    
      
      <a href="tag/devops.html">devops</a>
      
    </span>
  
  

  <div class="section" id="deploying-a-ruby-application-with-ansible">
<h1>Deploying a Ruby Application with Ansible<a class="headerlink" href="#deploying-a-ruby-application-with-ansible" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Nowadays, you can get your own dedicated server up and running in
seconds. Once you get it up, do you really need to spend several hours
on configuring it for your application&#8217;s needs? Do you really want to
repeat the same steps with each new server? In this article, I will give
you an idea about automated installation with Ansible, a Simple IT
Automation toolkit, and Ubuntu 14.04 LTS server as your box OS.</p>
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>You would need a basic understanding of Ansible file syntax. If you
haven&#8217;t played around with Ansible yet, I would recommend you review
some intro articles like <a class="reference external" href="http://docs.ansible.com/ansible/intro.html">http://docs.ansible.com/ansible/intro.html</a> or
perhaps one of the SlideShares like
<a class="reference external" href="http://www.slideshare.net/robertreiz/ansible-40167296">http://www.slideshare.net/robertreiz/ansible-40167296</a>?</p>
</div>
<div class="section" id="cooking">
<h2>Cooking<a class="headerlink" href="#cooking" title="Permalink to this headline">¶</a></h2>
<p>We would need to deploy the following components: Ruby, Web server with
Passenger, and your application itself. For the purposes of this demo,
we will install a well-known starter Devise
<a class="reference external" href="https://github.com/RailsApps/rails-devise.git">https://github.com/RailsApps/rails-devise.git</a></p>
<div class="section" id="ruby-switcher-chruby">
<h3>Ruby switcher chruby<a class="headerlink" href="#ruby-switcher-chruby" title="Permalink to this headline">¶</a></h3>
<p>I used to choose RMV previously, but recently I am a fan of <strong>chruby</strong> -
it is lightweight, quick to understand and just works - it&#8217;s available
at GitHub <a class="reference external" href="https://github.com/postmodern/chruby">https://github.com/postmodern/chruby</a></p>
<p>Upon studying the installation instructions, we can automate manual
installation steps with Ansible, and get a bonus: a reusable recipe to
install <code class="docutils literal"><span class="pre">ch_ruby</span></code>.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="o">---</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">chruby</span> <span class="ow">is</span> <span class="n">present</span>
    <span class="n">shell</span><span class="p">:</span> <span class="n">test</span> <span class="o">-</span><span class="n">x</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">chruby</span><span class="o">-</span><span class="n">exec</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_system</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span>
    <span class="n">ignore_errors</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">register</span><span class="p">:</span> <span class="n">chruby_present</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Download</span> <span class="n">chruby</span> <span class="n">distribution</span>
    <span class="n">get_url</span><span class="p">:</span> <span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://github.com/postmodern/chruby/archive/v{{ chruby_version }}.tar.gz&quot;</span>
             <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/tmp/chruby-{{ chruby_version }}.tar.gz&quot;</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">chruby_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">unpack</span> <span class="n">chruby</span>
    <span class="n">command</span><span class="p">:</span> <span class="n">tar</span> <span class="n">xf</span> <span class="s2">&quot;/tmp/chruby-{{ chruby_version }}.tar.gz&quot;</span>
             <span class="n">chdir</span><span class="o">=</span><span class="s2">&quot;/tmp&quot;</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">chruby_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">chruby</span> <span class="n">install</span> <span class="n">target</span>
    <span class="n">command</span><span class="p">:</span> <span class="n">make</span> <span class="n">install</span>
             <span class="n">chdir</span><span class="o">=</span><span class="s2">&quot;/tmp/chruby-{{ chruby_version }}&quot;</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">chruby_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">autoload</span> <span class="n">script</span>
    <span class="n">template</span><span class="p">:</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;{{role_dir}}/templates/ch_ruby.sh.j2&quot;</span> <span class="n">dest</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">chruby</span><span class="o">.</span><span class="n">sh</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>
</pre></div>
</div>
</div>
<div class="section" id="ruby-install">
<h3>Ruby install<a class="headerlink" href="#ruby-install" title="Permalink to this headline">¶</a></h3>
<p><strong>Ruby-install</strong> is the second toolkit from the same author. At the
present moment, this approach is the #1 choice for me when I need to
install a specific Ruby version. This tool is available at GitHub under
address <a class="reference external" href="https://github.com/postmodern/ruby-install">https://github.com/postmodern/ruby-install</a></p>
<p>Once we study <code class="docutils literal"><span class="pre">ruby-install</span></code> setup notes, we can automate these steps
with a series of ansible steps:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="o">---</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">ruby</span> <span class="n">install</span> <span class="ow">is</span> <span class="n">present</span>
    <span class="n">shell</span><span class="p">:</span> <span class="n">test</span> <span class="o">-</span><span class="n">x</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="n">install</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_system</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span>
    <span class="n">ignore_errors</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">register</span><span class="p">:</span> <span class="n">rubyinstall_present</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Ruby</span> <span class="n">install</span> <span class="o">|</span> <span class="n">package</span> <span class="n">dependencies</span>
    <span class="n">apt</span><span class="p">:</span> <span class="n">pkg</span><span class="o">=</span><span class="p">{{</span> <span class="n">item</span> <span class="p">}}</span> <span class="n">state</span><span class="o">=</span><span class="n">present</span> <span class="n">force</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>  <span class="n">update_cache</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_system</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span>
    <span class="n">with_items</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span>
      <span class="o">-</span> <span class="n">libffi</span><span class="o">-</span><span class="n">dev</span>
      <span class="o">-</span> <span class="n">libgdbm</span><span class="o">-</span><span class="n">dev</span>
      <span class="o">-</span> <span class="n">libncurses5</span><span class="o">-</span><span class="n">dev</span>
      <span class="o">-</span> <span class="n">libreadline</span><span class="o">-</span><span class="n">dev</span>
      <span class="o">-</span> <span class="n">libreadline6</span><span class="o">-</span><span class="n">dev</span>
      <span class="o">-</span> <span class="n">libtinfo</span><span class="o">-</span><span class="n">dev</span>
      <span class="o">-</span> <span class="n">libyaml</span><span class="o">-</span><span class="n">dev</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Download</span> <span class="n">rubyinstall</span>
    <span class="n">get_url</span><span class="p">:</span> <span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">postmodern</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="n">install</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">v</span><span class="p">{{</span> <span class="n">ruby_install_version</span> <span class="p">}}</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
           <span class="n">dest</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="p">{{</span> <span class="n">ruby_install_version</span> <span class="p">}}</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">rubyinstall_present</span> <span class="o">|</span> <span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Unpack</span> <span class="n">ruby</span><span class="o">-</span><span class="n">install</span>
    <span class="n">command</span><span class="p">:</span> <span class="n">tar</span> <span class="n">xf</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="p">{{</span> <span class="n">ruby_install_version</span> <span class="p">}}</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
             <span class="n">chdir</span><span class="o">=/</span><span class="n">tmp</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">rubyinstall_present</span> <span class="o">|</span> <span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Run</span> <span class="n">ruby</span><span class="o">-</span><span class="n">install</span> <span class="n">install</span> <span class="n">target</span>
    <span class="n">command</span><span class="p">:</span> <span class="n">make</span> <span class="n">install</span>
           <span class="n">chdir</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="p">{{</span> <span class="n">ruby_install_version</span> <span class="p">}}</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">rubyinstall_present</span> <span class="o">|</span> <span class="n">failed</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Download</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">rubies</span> <span class="n">available</span>
    <span class="n">command</span><span class="p">:</span> <span class="n">ruby</span><span class="o">-</span><span class="n">install</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">rubyinstall_present</span> <span class="o">|</span> <span class="n">failed</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>
</pre></div>
</div>
</div>
<div class="section" id="ruby">
<h3>Ruby<a class="headerlink" href="#ruby" title="Permalink to this headline">¶</a></h3>
<p>Now it is time to install Ruby. Small comment here: if you deploy on a
shared server, you most likely would like to have an ability to have
multiple Ruby versions and to switch between them. On the other hand, if
you deploy your application to a dedicated host, usually I also replace
default system Ruby with the same Ruby version.</p>
<p>With the tools above, your Ruby installation recipe will be compact &amp;
clear:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="o">---</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Find</span> <span class="n">out</span> <span class="k">if</span> <span class="n">ruby_version</span> <span class="ow">is</span> <span class="n">already</span> <span class="n">installed</span>
    <span class="n">stat</span><span class="p">:</span> <span class="n">path</span><span class="o">=</span><span class="p">{{</span><span class="n">rubies_location</span><span class="p">}}</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="p">{{</span><span class="n">ruby_version</span><span class="p">}}</span>
    <span class="n">register</span><span class="p">:</span> <span class="n">ruby_version_present</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Install</span> <span class="n">ruby_version</span> <span class="k">if</span> <span class="n">necessary</span>
    <span class="n">command</span><span class="p">:</span> <span class="s1">&#39;/usr/local/bin/ruby-install ruby {{ruby_version}}&#39;</span>
    <span class="n">when</span><span class="p">:</span> <span class="ow">not</span> <span class="n">ruby_version_present</span><span class="o">.</span><span class="n">stat</span><span class="o">.</span><span class="n">exists</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>

  <span class="o">-</span> <span class="n">debug</span><span class="p">:</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;ruby_install_setsystem&quot;</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Update</span> <span class="n">SYSTEM</span> <span class="n">ruby_version</span> <span class="k">if</span> <span class="n">necessary</span>
    <span class="n">command</span><span class="p">:</span> <span class="s1">&#39;/usr/local/bin/ruby-install --system ruby {{ruby_version}}&#39;</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">option_ruby_install_setsystem</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">ruby</span>
</pre></div>
</div>
</div>
<div class="section" id="webserver-passenger">
<h3>Webserver &amp; passenger<a class="headerlink" href="#webserver-passenger" title="Permalink to this headline">¶</a></h3>
<p>Thanks to the Phusion Passenger team, who did a great job to provide
pre-built binaries for most of the popular platforms and configurations
at <a class="reference external" href="https://oss-binaries.phusionpassenger.com/">https://oss-binaries.phusionpassenger.com/</a>, we can skip the steps of
compiling phusion passengers from a source, recompiling, webserver, etc
&amp; use their pre-built binary instead.</p>
<p>Historically, I prefer Nginx over the classic choice Apache, thus we
will install a pre-built Nginx with passenger:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="o">---</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Nginx</span> <span class="o">|</span> <span class="n">Check</span> <span class="k">if</span> <span class="ow">is</span> <span class="n">present</span>
    <span class="n">command</span><span class="p">:</span> <span class="n">test</span> <span class="o">-</span><span class="n">x</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nginx</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span>
    <span class="n">ignore_errors</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">register</span><span class="p">:</span> <span class="n">nginx_present</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">nginx</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Passenger</span> <span class="o">|</span> <span class="n">Add</span> <span class="n">GPG</span> <span class="n">key</span> <span class="n">to</span> <span class="n">apt</span> <span class="n">keyring</span>
    <span class="n">apt_key</span><span class="p">:</span> <span class="n">keyserver</span><span class="o">=</span><span class="n">keyserver</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span> <span class="nb">id</span><span class="o">=</span><span class="mi">561</span><span class="n">F9B9CAC40B2F7</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">passenger</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Passenger</span> <span class="o">|</span> <span class="n">Install</span> <span class="n">needed</span> <span class="n">packages</span>
    <span class="n">apt</span><span class="p">:</span> <span class="n">state</span><span class="o">=</span><span class="n">present</span> <span class="n">pkg</span><span class="o">=</span><span class="s2">&quot;{{item}}&quot;</span>
    <span class="n">with_items</span><span class="p">:</span>
     <span class="o">-</span> <span class="n">apt</span><span class="o">-</span><span class="n">transport</span><span class="o">-</span><span class="n">https</span>
     <span class="o">-</span> <span class="n">ca</span><span class="o">-</span><span class="n">certificates</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">passenger</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Passenger</span> <span class="o">|</span> <span class="n">Add</span> <span class="n">nginx</span> <span class="n">extras</span> <span class="n">repository</span>
    <span class="n">apt_repository</span><span class="p">:</span> <span class="n">repo</span><span class="o">=</span><span class="s2">&quot;deb https://oss-binaries.phusionpassenger.com/apt/passenger trusty main&quot;</span> <span class="n">state</span><span class="o">=</span><span class="n">present</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">passenger</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ruby</span> <span class="o">|</span> <span class="n">Install</span> <span class="n">Nginx</span> <span class="n">extra</span> <span class="ow">and</span> <span class="n">Phusion</span> <span class="n">Passenger</span>
    <span class="n">apt</span><span class="p">:</span> <span class="n">state</span><span class="o">=</span><span class="n">present</span> <span class="n">update_cache</span><span class="o">=</span><span class="n">yes</span> <span class="n">pkg</span><span class="o">=</span><span class="s2">&quot;{{item}}&quot;</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">with_items</span><span class="p">:</span>
     <span class="o">-</span> <span class="n">nginx</span><span class="o">-</span><span class="n">extras</span>
     <span class="o">-</span> <span class="n">passenger</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">passenger</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Nginx</span> <span class="o">|</span> <span class="n">Create</span> <span class="n">sites</span> <span class="n">available</span><span class="o">/</span><span class="n">enabled</span> <span class="n">directories</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">path</span><span class="o">=</span><span class="p">{{</span><span class="n">item</span><span class="p">}}</span> <span class="n">state</span><span class="o">=</span><span class="n">directory</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0755</span>
    <span class="n">with_items</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">available</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nginx</span>
      <span class="o">-</span> <span class="n">passenger</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Nginx</span> <span class="o">|</span> <span class="n">Configure</span> <span class="n">include</span> <span class="n">sites</span><span class="o">-</span><span class="n">enabled</span>
    <span class="n">lineinfile</span><span class="p">:</span> <span class="n">dest</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">conf</span> <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;.*sites-enabled.*&quot;</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;    include /etc/nginx/sites-enabled/*;&quot;</span> <span class="n">insertbefore</span><span class="o">=</span><span class="s2">&quot;}&quot;</span> <span class="n">state</span><span class="o">=</span><span class="n">present</span>
    <span class="n">tags</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nginx</span>
      <span class="o">-</span> <span class="n">passenger</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Nginx</span> <span class="o">|</span> <span class="n">Disable</span> <span class="n">default</span> <span class="n">site</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">path</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/</span><span class="n">default</span> <span class="n">state</span><span class="o">=</span><span class="n">absent</span>
    <span class="n">tags</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nginx</span>
      <span class="o">-</span> <span class="n">passenger</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Nginx</span> <span class="o">|</span> <span class="n">Uncomment</span> <span class="n">server_names_hash_bucket_size</span>
    <span class="n">lineinfile</span><span class="p">:</span> <span class="n">dest</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">conf</span> <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;^(\s*)#\s*server_names_hash_bucket_size&quot;</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\1</span><span class="s2">server_names_hash_bucket_size 64;&quot;</span> <span class="n">backrefs</span><span class="o">=</span><span class="n">yes</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nginx</span>
      <span class="o">-</span> <span class="n">passenger</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Nginx</span> <span class="o">|</span> <span class="n">Set</span> <span class="n">ruby</span> <span class="n">to</span> <span class="n">system</span> <span class="n">one</span>
    <span class="n">lineinfile</span><span class="p">:</span> <span class="n">dest</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">conf</span> <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;^(\s*)#\s*passenger_ruby&quot;</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;passenger_ruby /usr/local/bin/ruby;&quot;</span> <span class="n">backrefs</span><span class="o">=</span><span class="n">yes</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nginx</span>
      <span class="o">-</span> <span class="n">passenger</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Nginx</span> <span class="o">|</span> <span class="n">Set</span> <span class="n">ruby</span> <span class="n">to</span> <span class="n">system</span> <span class="n">one</span>
    <span class="n">lineinfile</span><span class="p">:</span> <span class="n">dest</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">conf</span> <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;^(\s*)#\s*passenger_root&quot;</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;passenger_root /usr/lib/ruby/vendor_ruby/phusion_passenger/locations.ini;&quot;</span> <span class="n">backrefs</span><span class="o">=</span><span class="n">yes</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nginx</span>
      <span class="o">-</span> <span class="n">passenger</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Nginx</span> <span class="o">|</span> <span class="n">Reload</span>
    <span class="n">service</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="n">nginx</span> <span class="n">state</span><span class="o">=</span><span class="n">reloaded</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_os_family</span> <span class="o">==</span> <span class="s2">&quot;Debian&quot;</span> <span class="ow">and</span> <span class="n">nginx_present</span><span class="o">|</span><span class="n">failed</span>
    <span class="n">tags</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nginx</span>
      <span class="o">-</span> <span class="n">passenger</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
</pre></div>
</div>
<p>Several comments on the installation script above, which might require
changes based on your own scenarios:</p>
<ol class="arabic">
<li><p class="first">The task named &#8220;Create sites available/enabled directories&#8221; &amp; the
next one actually implements an Apache-like &#8220;sites-available /
sites-enabled&#8221; folder structure for VHosts configs. If you prefer the
default setup, comment that part out.</p>
</li>
<li><p class="first">Specifying ruby location to passenger with</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">lineinfile</span><span class="p">:</span> <span class="n">dest</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">conf</span> <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;^(\s*)#\s*passenger_ruby&quot;</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;passenger_ruby /usr/local/bin/ruby;&quot;</span> <span class="n">backrefs</span><span class="o">=</span><span class="n">yes</span>
</pre></div>
</div>
<p>As you see, the replacement above assumes that your system Ruby is
used. You might want to specify a different ruby path here.</p>
</li>
</ol>
<p>The goal of these two tasks is to take <code class="docutils literal"><span class="pre">nginx.conf</span></code> &amp; set two
parameters: <code class="docutils literal"><span class="pre">passenger_root</span></code> and <code class="docutils literal"><span class="pre">passenger_ruby</span></code> as per original
instuctions in above comment.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>        <span class="c1">##</span>
        <span class="c1"># Uncomment it if you installed passenger or passenger-enterprise</span>
        <span class="c1">##</span>

<span class="n">passenger_root</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">vendor_ruby</span><span class="o">/</span><span class="n">phusion_passenger</span><span class="o">/</span><span class="n">locations</span><span class="o">.</span><span class="n">ini</span><span class="p">;</span>
<span class="n">passenger_ruby</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ruby</span><span class="p">;</span>
</pre></div>
</div>
<p>How would you validate that if you&#8217;ve installed nginx with passenger
right ?</p>
<p>You can do so by executing these commands to validate the setup:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>sudo /usr/bin/passenger-config validate-install

What would you like to validate?
Use &lt;space&gt; to select.
If the menu doesn&#39;t display correctly, press &#39;!&#39;

 ‣ ⬢  Passenger itself
   ⬡  Apache

-------------------------------------------------------------------------

 * Checking whether this Passenger install is in PATH... ✓
 * Checking whether there are no other Passenger installations... ✓

Everything looks good. :-)
</pre></div>
</div>
<p>As for <code class="docutils literal"><span class="pre">/usr/sbin/passenger-memory-stats</span></code>, you should see both Nginx &amp;
passenger processes.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>sudo /usr/sbin/passenger-memory-stats
Version: 5.0.26
Date   : 2016-03-18 11:17:57 +0200
------------- Apache processes -------------
*** WARNING: The Apache executable cannot be found.
Please set the APXS2 environment variable to your &#39;apxs2&#39; executable&#39;s filename, or set the HTTPD environment variable to your &#39;httpd&#39; or &#39;apache2&#39; executable&#39;s filename.

--------- Nginx processes ----------
PID   PPID  VMSize    Private  Name
------------------------------------
8768  9991  138.1 MB  1.1 MB   nginx: worker process
8769  9991  137.8 MB  0.9 MB   nginx: worker process
8770  9991  137.8 MB  0.9 MB   nginx: worker process
8771  9991  137.8 MB  0.9 MB   nginx: worker process
9991  1     137.8 MB  0.9 MB   nginx: master process /usr/sbin/nginx
### Processes: 5
### Total private dirty RSS: 4.68 MB

---- Passenger processes -----
PID   VMSize    Private  Name
------------------------------
8742  436.3 MB  1.0 MB   Passenger watchdog
8745  982.9 MB  2.0 MB   Passenger core
8756  444.5 MB  1.1 MB   Passenger ust-router
8806  387.1 MB  69.3 MB  Passenger RubyApp: /var/www/public (production)
### Processes: 4
### Total private dirty RSS: 73.47 MB
slavko@ERM:/etc/nginx$
</pre></div>
</div>
</div>
</div>
<div class="section" id="application-setup-itself">
<h2>Application setup itself<a class="headerlink" href="#application-setup-itself" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s define your application parameters: in particular, required OS
packages to build gems, app secret and to hash the passwords,
application environment parameters, database connection details.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>  <span class="n">app_dependencies</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">libsqlite3</span><span class="o">-</span><span class="n">dev</span>
    <span class="o">-</span> <span class="n">libmysqlclient</span><span class="o">-</span><span class="n">dev</span>
    <span class="o">-</span> <span class="n">libpq</span><span class="o">-</span><span class="n">dev</span>
    <span class="o">-</span> <span class="n">git</span>
    <span class="o">-</span> <span class="n">nodejs</span>
    <span class="o">-</span> <span class="n">npm</span>

  <span class="n">app_short_name</span><span class="p">:</span> <span class="n">app</span>
  <span class="n">app_env</span><span class="p">:</span> <span class="n">production</span>
  <span class="n">app_domain</span><span class="p">:</span> <span class="n">domain</span><span class="o">.</span><span class="n">local</span>
  <span class="n">app_secret</span><span class="p">:</span> <span class="mi">82</span><span class="n">d58d3dfb91238b495a311eb8539edf5064784f1d58994679db8363ec241c745bef0b446bfe44d66cbf91a2f4e497d8f6b1ef1656e3f405b0d263a9617ac75e</span>
  <span class="n">app_repository</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">RailsApps</span><span class="o">/</span><span class="n">rails</span><span class="o">-</span><span class="n">devise</span><span class="o">.</span><span class="n">git</span>
<span class="c1">#  app_repository_keyname: id_rsa_app</span>
  <span class="n">app_base_dir</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span>
  <span class="n">app_www_root</span><span class="p">:</span> <span class="s2">&quot;{{app_base_dir}}/public&quot;</span>

  <span class="n">app_env_vars</span><span class="p">:</span>
    <span class="o">-</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">SECRET_KEY_BASE</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;{{app_secret}}&quot;</span> <span class="p">}</span>
    <span class="o">-</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">DATABASE_URL</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;postgres://{{app_db_user}}:{{app_db_password}}@{{app_db_host}}/{{app_db_name}}&quot;</span><span class="p">}</span>
    <span class="o">-</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">RAILS_ENV</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;{{app_env}}&quot;</span> <span class="p">}</span>
    <span class="o">-</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">DOMAIN_NAME</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;{{app_domain}}&quot;</span> <span class="p">}</span>

  <span class="n">app_db_host</span><span class="p">:</span> <span class="n">localhost</span>
  <span class="n">app_db_user</span><span class="p">:</span> <span class="n">app_user</span>
  <span class="n">app_db_password</span><span class="p">:</span> <span class="n">app_password</span>
  <span class="n">app_db_name</span><span class="p">:</span> <span class="n">app_database</span>

  <span class="n">app_directories</span><span class="p">:</span>
    <span class="o">-</span> <span class="s2">&quot;{{app_base_dir}}&quot;</span>
</pre></div>
</div>
<p>The application provisioning script itself goes into stages: OS packages
dependencies, Gem dependencies (for devise it is sqlite3), checking out
the source code, patching Gem file so the ruby version matches the one
installed on host + introducing production gems for uglifyjs (this is
current app specifics), bundle install, patching database configuration,
assets compilation, db migration, generating nginx site configuration,
restarting the web server.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="o">---</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">Dependencies</span>
    <span class="n">apt</span><span class="p">:</span> <span class="n">pkg</span><span class="o">=</span><span class="p">{{</span> <span class="n">item</span> <span class="p">}}</span> <span class="n">state</span><span class="o">=</span><span class="n">present</span> <span class="n">force</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>  <span class="n">update_cache</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">ansible_system</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span>
    <span class="n">with_items</span><span class="p">:</span> <span class="s2">&quot;{{app_dependencies}}&quot;</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">Install</span> <span class="n">gem</span> <span class="n">dependencies</span>
    <span class="n">shell</span><span class="p">:</span> <span class="s2">&quot;gem install --no-rdoc --no-ri {{item}}&quot;</span>
    <span class="n">with_items</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">sqlite3</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">Re</span><span class="o">-</span><span class="n">create</span> <span class="n">base</span> <span class="n">app</span> <span class="n">directory</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">path</span><span class="o">=</span><span class="p">{{</span><span class="n">app_base_dir</span><span class="p">}}</span> <span class="n">state</span><span class="o">=</span><span class="n">absent</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">Create</span> <span class="n">directories</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">path</span><span class="o">=</span><span class="p">{{</span><span class="n">item</span><span class="p">}}</span> <span class="n">state</span><span class="o">=</span><span class="n">directory</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0755</span> <span class="n">owner</span><span class="o">=</span><span class="p">{{</span><span class="n">ansible_user_id</span><span class="p">}}</span> <span class="n">group</span><span class="o">=</span><span class="p">{{</span><span class="n">ansible_user_id</span><span class="p">}}</span>
    <span class="n">with_items</span><span class="p">:</span> <span class="s2">&quot;{{app_directories}}&quot;</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">Checkout</span> <span class="n">app</span> <span class="n">without</span> <span class="n">key</span>
    <span class="n">git</span><span class="p">:</span> <span class="n">repo</span><span class="o">=</span><span class="s2">&quot;{{app_repository}}&quot;</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;{{app_base_dir}}&quot;</span> <span class="n">accept_hostkey</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span> <span class="n">force</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
    <span class="n">when</span><span class="p">:</span> <span class="n">app_repository_keyname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">Install</span> <span class="k">global</span> <span class="n">rails</span> <span class="n">gem</span>
    <span class="n">shell</span><span class="p">:</span> <span class="n">gem</span> <span class="n">install</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">rdoc</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">ri</span> <span class="n">rails</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">Eliminate</span> <span class="n">ruby</span> <span class="n">req</span>
    <span class="n">lineinfile</span><span class="p">:</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;{{app_base_dir}}/Gemfile&quot;</span> <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;^(\s*)*ruby&quot;</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;ruby &#39;{{ruby_version}}&#39;&quot;</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">gem</span> <span class="n">therubyracer</span> <span class="o">-</span> <span class="n">uglifyjs</span>
    <span class="n">lineinfile</span><span class="p">:</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;{{app_base_dir}}/Gemfile&quot;</span> <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;^(\s*)*gem &#39;therubyracer&#39;&quot;</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;gem &#39;therubyracer&#39;, :platforms =&gt; :ruby&quot;</span> <span class="n">insertafter</span><span class="o">=</span><span class="s2">&quot;^group :production do&quot;</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">gem</span> <span class="n">execjs</span> <span class="o">-</span> <span class="n">uglifyjs</span>
    <span class="n">lineinfile</span><span class="p">:</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;{{app_base_dir}}/Gemfile&quot;</span> <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;^(\s*)*gem &#39;execjs&#39;&quot;</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;gem &#39;execjs&#39;&quot;</span> <span class="n">insertafter</span><span class="o">=</span><span class="s2">&quot;^group :production do&quot;</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">gem</span> <span class="n">pg</span>
    <span class="n">lineinfile</span><span class="p">:</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;{{app_base_dir}}/Gemfile&quot;</span> <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;^(\s*)*gem &#39;pg&#39;&quot;</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;gem &#39;pg&#39;&quot;</span> <span class="n">insertafter</span><span class="o">=</span><span class="s2">&quot;^group :production do&quot;</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">Run</span> <span class="n">bundle</span> <span class="n">install</span> <span class="o">--</span><span class="n">path</span> <span class="o">.</span><span class="n">bundle</span><span class="o">/</span><span class="n">gems</span> <span class="o">--</span><span class="n">binstubs</span> <span class="o">.</span><span class="n">bundle</span><span class="o">/</span><span class="nb">bin</span>
    <span class="n">shell</span><span class="p">:</span> <span class="n">bundle</span> <span class="n">install</span>  <span class="o">--</span><span class="n">path</span> <span class="o">.</span><span class="n">bundle</span><span class="o">/</span><span class="n">gems</span> <span class="o">--</span><span class="n">binstubs</span> <span class="o">.</span><span class="n">bundle</span><span class="o">/</span><span class="nb">bin</span>
    <span class="n">args</span><span class="p">:</span>
      <span class="n">chdir</span><span class="p">:</span> <span class="s2">&quot;{{app_base_dir}}&quot;</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">database</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">template</span><span class="p">:</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;{{root_dir}}/templates/app/database.yml.j2&quot;</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;{{app_base_dir}}/config/database.yml&quot;</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">Precompile</span> <span class="n">assets</span>
    <span class="n">shell</span><span class="p">:</span> <span class="n">bundle</span> <span class="n">exec</span> <span class="n">rake</span> <span class="n">assets</span><span class="p">:</span><span class="n">precompile</span>
    <span class="n">args</span><span class="p">:</span>
      <span class="n">chdir</span><span class="p">:</span> <span class="s2">&quot;{{app_base_dir}}&quot;</span>
    <span class="n">environment</span><span class="p">:</span>
      <span class="n">RAILS_ENV</span><span class="p">:</span> <span class="s2">&quot;{{app_env}}&quot;</span>
      <span class="n">DATABASE_URL</span><span class="p">:</span> <span class="s2">&quot;postgres://{{app_db_user}}:{{app_db_password}}@{{app_db_host}}/{{app_db_name}}&quot;</span>
      <span class="n">SECRET_KEY_BASE</span><span class="p">:</span> <span class="s2">&quot;{{app_secret}}&quot;</span>
      <span class="n">DOMAIN_NAME</span><span class="p">:</span> <span class="s2">&quot;{{app_domain}}&quot;</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">DB</span> <span class="n">Migrate</span>
    <span class="n">shell</span><span class="p">:</span> <span class="n">bundle</span> <span class="n">exec</span> <span class="n">rake</span> <span class="n">db</span><span class="p">:</span><span class="n">migrate</span>
    <span class="n">args</span><span class="p">:</span>
      <span class="n">chdir</span><span class="p">:</span> <span class="s2">&quot;{{app_base_dir}}&quot;</span>
    <span class="n">environment</span><span class="p">:</span>
      <span class="n">RAILS_ENV</span><span class="p">:</span> <span class="s2">&quot;{{app_env}}&quot;</span>
      <span class="n">DATABASE_URL</span><span class="p">:</span> <span class="s2">&quot;postgres://{{app_db_user}}:{{app_db_password}}@{{app_db_host}}/{{app_db_name}}&quot;</span>
      <span class="n">SECRET_KEY_BASE</span><span class="p">:</span> <span class="s2">&quot;{{app_secret}}&quot;</span>
      <span class="n">DOMAIN_NAME</span><span class="p">:</span> <span class="s2">&quot;{{app_domain}}&quot;</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">APP</span> <span class="n">STUB</span> <span class="o">|</span> <span class="n">Nginx</span> <span class="n">conf</span>
    <span class="n">template</span><span class="p">:</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;{{root_dir}}/templates/nginx_app.conf.j2&quot;</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/etc/nginx/sites-enabled/{{app_short_name}}.conf&quot;</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Nginx</span> <span class="o">|</span> <span class="n">Reload</span>
    <span class="n">service</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="n">nginx</span> <span class="n">state</span><span class="o">=</span><span class="n">reloaded</span>
    <span class="n">become</span><span class="p">:</span> <span class="n">yes</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">app_stub</span>
</pre></div>
</div>
<p>In particular, we patch the database config/database.yml with real
connection details</p>
<div class="code ruby highlight-default"><div class="highlight"><pre><span></span><span class="c1"># On Heroku and other platform providers, you may have a full connection URL</span>
<span class="c1"># available as an environment variable. For example:</span>
<span class="c1">#</span>
<span class="c1">#   DATABASE_URL=&quot;postgres://myuser:mypass@localhost/somedatabase&quot;</span>
<span class="c1">#</span>
<span class="c1"># You can use this database configuration with:</span>
<span class="c1">#</span>
   <span class="n">production</span><span class="p">:</span>
     <span class="n">url</span><span class="p">:</span> <span class="o">&lt;%=</span> <span class="n">ENV</span><span class="p">[</span><span class="s1">&#39;DATABASE_URL&#39;</span><span class="p">]</span> <span class="o">%&gt;</span>
</pre></div>
</div>
<p>And we patch the Nginx app site config to provide app environment
variables to ruby app with <code class="docutils literal"><span class="pre">passenger_env_var</span></code> instructions.</p>
<div class="code ruby highlight-default"><div class="highlight"><pre><span></span><span class="n">server</span> <span class="p">{</span>
  <span class="n">listen</span> <span class="mi">80</span> <span class="n">default_server</span><span class="p">;</span>
  <span class="n">passenger_enabled</span> <span class="n">on</span><span class="p">;</span>

  <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">envvar</span> <span class="ow">in</span> <span class="n">app_env_vars</span> <span class="o">%</span><span class="p">}</span>
  <span class="n">passenger_env_var</span> <span class="p">{{</span> <span class="n">envvar</span><span class="o">.</span><span class="n">name</span> <span class="p">}}</span> <span class="s2">&quot;{{ envvar.value }}&quot;</span><span class="p">;</span>
  <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>

  <span class="n">passenger_app_env</span> <span class="p">{{</span><span class="n">app_env</span><span class="p">}};</span>
  <span class="n">root</span> <span class="p">{{</span><span class="n">app_www_root</span><span class="p">}};</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-code">
<h2>Running the code<a class="headerlink" href="#running-the-code" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s execute the provisioning &amp; test it. For purposes of the demo, we
will use a local postgres as our DB.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="n">www</span>

  <span class="nb">vars</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">root_dir</span><span class="p">:</span> <span class="o">..</span>

  <span class="n">roles</span><span class="p">:</span>
     <span class="o">-</span> <span class="p">{</span>
         <span class="n">role</span><span class="p">:</span> <span class="s2">&quot;sa-postgres&quot;</span><span class="p">,</span>
         <span class="n">option_create_app_user</span><span class="p">:</span> <span class="n">true</span>
       <span class="p">}</span>
     <span class="o">-</span> <span class="p">{</span>
         <span class="n">role</span><span class="p">:</span> <span class="s2">&quot;sa-ruby&quot;</span><span class="p">,</span>
         <span class="n">ruby_install_setsystem</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
         <span class="n">ruby_version</span><span class="p">:</span> <span class="mf">2.3</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span>

         <span class="n">option_install_sampleapp</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
         <span class="n">option_install_nginx_passenger</span><span class="p">:</span> <span class="n">true</span>
       <span class="p">}</span>
</pre></div>
</div>
<p>Once the application provisioning process is over:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">TASK</span><span class="p">:</span> <span class="p">[</span><span class="n">sa</span><span class="o">-</span><span class="n">ruby</span> <span class="o">|</span> <span class="n">Nginx</span> <span class="o">|</span> <span class="n">Reload</span><span class="p">]</span> <span class="o">**********************************************</span>
<span class="n">changed</span><span class="p">:</span> <span class="p">[</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">0.17</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s2">&quot;changed&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;nginx&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;started&quot;</span><span class="p">}</span>

<span class="n">PLAY</span> <span class="n">RECAP</span> <span class="o">********************************************************************</span>
<span class="mf">192.168</span><span class="o">.</span><span class="mf">0.17</span>               <span class="p">:</span> <span class="n">ok</span><span class="o">=</span><span class="mi">55</span>   <span class="n">changed</span><span class="o">=</span><span class="mi">46</span>   <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>

<span class="n">Play</span> <span class="n">run</span> <span class="n">took</span> <span class="mi">23</span> <span class="n">minutes</span>
</pre></div>
</div>
<p>So, depending on your network speed, you&#8217;ll have your application
installed.</p>
<p>Let&#8217;s check through the ip address:</p>
<div class="figure" id="id1">
<img alt="Application deployed" src="https://raw.githubusercontent.com/Voronenko/devops-ruby-app-demo/master/docs/app_deployed.png" />
<p class="caption"><span class="caption-text">Deployed application</span></p>
</div>
</div>
<div class="section" id="points-of-interest">
<h2>Points of Interest<a class="headerlink" href="#points-of-interest" title="Permalink to this headline">¶</a></h2>
<p>Now you aware of another way to deploy your ruby applications.</p>
<p>Demo deployment script is available at
<a class="reference external" href="https://github.com/Voronenko/devops-ruby-app-demo">https://github.com/Voronenko/devops-ruby-app-demo</a>, recipes packed as
ansible reusable role available at
<a class="reference external" href="https://github.com/softasap/sa-ruby">https://github.com/softasap/sa-ruby.</a></p>
</div>
</div>

</div>
<div class="col-sm-3 mb20">
  
  <h3><a href="tag.html">Tags</a></h3>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="tag/ansible.html">ansible</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/aws.html">aws</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/cloud.html">cloud</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/continuous-delivery.html">continuous-delivery</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="tag/deployment.html">deployment</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/development.html">development</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="tag/devops.html">devops</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/esxi.html">esxi</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/java.html">java</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/jenkins.html">jenkins</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/jumpbox.html">jumpbox</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/lamp.html">lamp</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/letsencrypt.html">letsencrypt</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/process.html">process</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/ruby.html">ruby</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="tag/tip.html">tip</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/vagrant.html">vagrant</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/vpc.html">vpc</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="tag/workplace.html">workplace</a></li>
      
    
  </ul>


  
  <h3><a href="category.html">Categories</a></h3>
  <ul class="ablog-categories">
  
    
    <li><a href="category/field-notes.html">field notes (4)</a></li>
    
  
    
    <li><a href="category/from-oops-to-devops.html">from-oops-to-devops (6)</a></li>
    
  
    
    <li><a href="category/knowledge-sharing.html">knowledge sharing (3)</a></li>
    
  
  </ul>


  
  <h3><a href="archive.html">Archives</a></h3>
  <ul>
  
    
    <li><a href="2017.html">2017 (3)</a></li>
    
  
    
    <li><a href="2016.html">2016 (10)</a></li>
    
  
  </ul>


</div>
</div>
</div>




  
  <div class="section">
    <div class="row">
      <div class="col-sm-1 mb20">
      </div>
      <div class="col-sm-8 mb20">
        


<div class="section">
  <span style="float: left;">
  
  
  <a href="2016-03-gitflow.html">
    <i class="fa fa-arrow-circle-left"></i>
    Implementing git-flow Releasing Model in Continuous Integration Process
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="2016-05-jenkins.html">
    Setup & Configure Jenkins for Your Team
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

      </div>
      <div class="col-sm-3 mb20">
      </div>
    </div>
  </div>
  
  </div>
  

      </div>
    </div>
    <!-- /#all -->

<!-- #### JAVASCRIPT FILES ### -->

<!-- js base -->
<script src=".././_static/js/jquery-1.11.0.min.js"></script>
<script src=".././_static/js/bootstrap.min.js"></script>


<!-- for demo purpose -->
<script src=".././_static/js/jquery.cookie.js"></script>

<!-- waypoints for scroll spy -->
<script src=".././_static/js/waypoints.min.js"></script>

<!-- masonry layout -->
<script src=".././_static/js/masonry.pkgd.min.js"></script>

<!-- owl carousel -->
<script src=".././_static/js/owl.carousel.min.js"></script>


<!-- jQuery scroll to -->
<script src=".././_static/js/jquery.scrollTo.min.js"></script>

<!-- main js file -->
<script src=".././_static/js/front.js"></script>


</body>

</html>